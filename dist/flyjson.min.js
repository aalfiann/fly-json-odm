"use strict";function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(r){var i=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(r);return _possibleConstructorReturn(this,i?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).FlyJson=t()}(function(){var define,module,exports;return function i(n,o,s){function a(e,t){if(!o[e]){if(!n[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(u)return u(e,!0);throw(r=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",r}r=o[e]={exports:{}},n[e][0].call(r.exports,function(t){return a(n[e][1][t]||t)},r,r.exports,i,n,o,s)}return o[e].exports}for(var u="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}({1:[function(t,e,r){var i=t("./helper"),h=t("./operator"),t=function(){_inherits(r,i);var e=_createSuper(r);function r(){var t;return _classCallCheck(this,r),(t=e.call(this)).data1=[],t.data2=[],t.query=[],t.result=[],t}return _createClass(r,[{key:"_sortBy",value:function(e,r,i){var n=i?function(t){return i(t[e])}:function(t){return t[e]};return r=r?-1:1,function(t,e){return t=n(t),e=n(e),r*((e<t)-(t<e))}}},{key:"_findDistinct",value:function(n,e){for(var o=this,s=!1,t=0;t<n.length;t++)!function(r){var t=Object.keys(e).length,i=0;o.foreach(e,function(t,e){n[r][e]===t&&i++}),t===i&&(s=!0)}(t);return s}},{key:"setMode",value:function(t){return this.mode=t.toString().toLowerCase(),this}},{key:"set",value:function(t){if(!this.isArray(t))throw new Error("Set data must be an array contains object.");return"shallow"===this.mode?this.data1=this.shallowClone(t):this.data1=this.deepClone(t),this}},{key:"insert",value:function(t){if(!this.isObject(t)||this.isEmptyObject(t))throw new Error("New value must be an object and not empty");return this.data1.push(t),this}},{key:"insertMany",value:function(t){if(!this.isArray(t))throw new Error("Data must be an array object");for(var e=t.length,r=0;r<e;r++){if(!this.isObject(t[r])||this.isEmptyObject(t[r]))throw new Error("New value must be an object and not empty");this.data1.push(t[r])}return this}},{key:"update",value:function(t,e,r){if(this.isEmpty(t)||this.isEmpty(e))throw new Error("Key and Value must be defined and value must be unique");if(!this.isObject(r)||this.isEmptyObject(r))throw new Error("New value must be an object and not empty");for(var i=this.data1.length,n=0;n<i;n++)if(this.data1[n][t]===e){this.data1.splice(n,1),this.data1.push(Object.assign(_defineProperty({},t,e),r));break}return this}},{key:"updateMany",value:function(t,e){if(this.isEmpty(t)||!this.isString(t))throw new Error("Key and Value must be defined and value must be unique");if(this.isEmptyArray(e)||!this.isArray(e))throw new Error("Data to update must be an array object and not empty");for(var r,i=this.data1.length,n=e.length,o=[],s=0;s<i;s++){r=!1;for(var a=0;a<n;a++)this.data1[s][t]===e[a][t]&&(r=!0,o.push(e[a]));!1===r&&o.push(this.data1[s])}return this.data1=o,this}},{key:"modify",value:function(t,e,r){if(this.isEmpty(t)||this.isEmpty(e))throw new Error("Key and Value must be defined and value must be unique");if(!this.isObject(r)||this.isEmptyObject(r))throw new Error("New value must be an object and not empty");for(var i,n=this.data1.length,o=0;o<n;o++)if(this.data1[o][t]===e){i=this.data1[o],this.data1.splice(o,1),this.data1.push(Object.assign(_defineProperty({},t,e),i,r));break}return this}},{key:"modifyMany",value:function(t,e){if(this.isEmpty(t)||!this.isString(t))throw new Error("Key must be defined");if(this.isEmptyArray(e)||!this.isArray(e))throw new Error("Data to modify must be an array object and not empty");if("shallow"===this.mode)throw new Error("Shallow mode is not allowed for modifyMany!");for(var r,i,n=this.data1.length,o=e.length,s=[],a=0;a<n;a++){i=!1;for(var u=0;u<o;u++)this.data1[a][t]===e[u][t]&&(i=!0,r=this.data1[a],s.push(Object.assign(r,e[u])));!1===i&&s.push(this.data1[a])}return this.data1=s,this}},{key:"delete",value:function(t,e){if(this.isEmpty(t)||this.isEmpty(e))throw new Error("Key and Value must be defined also remember that Value must be unique.");for(var r=this.data1.length,i=0;i<r;i++)if(this.data1[i][t]===e){this.data1.splice(i,1);break}return this}},{key:"deleteMany",value:function(t,e){if(this.isEmpty(t)||this.isEmptyArray(e))throw new Error("Key and Data array of key value must be defined.");for(var r=this.data1.length,i=e.length,n=[],o=!1,s=0;s<r;s++){o=!1;for(var a=0;a<i;a++)this.data1[s][t]===e[a]&&(o=!0);!1===o&&n.push(this.data1[s])}return this.data1=n,this}},{key:"select",value:function(t){if(!this.isEmpty(t)&&this.isArray(t)&&!this.isEmptyArray(t)){for(var e,r=[],i=this.data1.length,n=t.length,o=0;o<i;o++){e={};for(var s=0;s<n;s++)void 0!==this.data1[o][t[s]]&&(e[t[s]]=this.data1[o][t[s]]);r.push(e)}this.data1=r}return this}},{key:"where",value:function(){var t,r,i,n,o,s,a,e,u=[];return!this.isEmpty(arguments.length<=0?void 0:arguments[0])&&this.isString(arguments.length<=0?void 0:arguments[0])&&void 0!==(arguments.length<=1?void 0:arguments[1])&&(r=!0,2<arguments.length?(i=arguments.length<=1?void 0:arguments[1],t=arguments.length<=0?void 0:arguments[0],e=arguments.length<=2?void 0:arguments[2],this.isEmpty(arguments.length<=3?void 0:arguments[3])||(r=arguments.length<=3?void 0:arguments[3])):(i="===",t=arguments.length<=0?void 0:arguments[0],e=arguments.length<=1?void 0:arguments[1],r=!0),i=i.toString().toLowerCase(),n=_defineProperty({},t,e),e=(a=this).data1.filter(function(e){return Object.keys(n).every(function(t){switch(o=e[t],s=n[t],!1===r&&"regex"!==i&&(a.isObject(e[t])||(o=e[t]&&e[t].toString().toLowerCase()),s=n[t].toString().toLowerCase()),i){case"=":return h.unstrict(i,o,s);case"!==":return o!==s;case"==":case"!=":return h.unstrict(i,o,s);case">":return s<o;case">=":return s<=o;case"<":return o<s;case"<=":return o<=s;case"in":return a.isString(o)?-1!==o.indexOf(s):(u=[],o&&a.foreach(o,function(t){r?t===s&&u.push(t):(t=a.isString(t)?t.toLowerCase():t)===s&&u.push(t)}),0<u.length);case"in like":return a.isString(o)?-1!==o.indexOf(s):(u=[],o&&a.foreach(o,function(t){r?a.isString(t)&&-1!==t.toString().indexOf(s)&&u.push(t):a.isString(t)&&-1!==(t=t.toLowerCase()).indexOf(s)&&u.push(t)}),0<u.length);case"not in":return a.isString(o)?-1===o.indexOf(s):(u=[],o&&o.length?(a.foreach(o,function(t){t!==s&&u.push(t)}),u.length===o.length):!!a.isObject(o)&&(a.foreach(o,function(t){r?t!==s&&u.push(t):(t=a.isString(t)?t.toLowerCase():t)!==s&&u.push(t)}),u.length===Object.keys(o).length));case"not in like":return a.isString(o)?-1===o.indexOf(s):(u=[],o&&o.length?(a.foreach(o,function(t){null!=t&&(a.isString(t)||(t=t.toString())),a.isString(t)&&-1!==t.indexOf(s)||u.push(t)}),u.length===o.length):!!a.isObject(o)&&(a.foreach(o,function(t){r?(null!=t&&(a.isString(t)||(t=t.toString())),a.isString(t)&&-1!==t.indexOf(s)||u.push(t)):(null!=t&&(a.isString(t)||(t=t.toString())),a.isString(t)&&-1!==(t=t.toLowerCase()).indexOf(s)||u.push(t))}),u.length===Object.keys(o).length));case"not":return o!==s;case"like":return-1!==o.indexOf(s);case"not like":return-1===o.indexOf(s);case"regex":return s.test(o);case"func":case"function":return s(o);default:return o===s}})}),"query"===this.scope?this.result=e:this.data1=e),this}},{key:"begin",value:function(){return this.scope="query",this}},{key:"or",value:function(){if("query"===this.scope)for(var t=this.result.length,e=0;e<t;e++)this.query.push(this.result[e]);return this}},{key:"end",value:function(){if("query"===this.scope){for(var t=this.result.length,e=0;e<t;e++)this.query.push(this.result[e]);this.data1=this.query,this.query=[],this.result=[],this.scope=""}return this}},{key:"distinct",value:function(t){if(t=void 0===t?"":t,!this.isEmpty(t)&&!this.isString(t)||this.isArray(t)||this.isObject(t))throw new Error("Field name must be string.");var e=this.data1,r=[],i=[],n=e.length;if(!this.isEmpty(t)&&this.isString(t))for(var o=0;o<n;o++)void 0===e[o][t]||r[e[o][t]]||(i.push(e[o]),r[e[o][t]]=1);else for(var s=0;s<n;s++)!1===this._findDistinct(r,e[s])&&(i.push(e[s]),r.push(e[s]));return this.data1=i,this}},{key:"clean",value:function(){return this.data1=[],this.data2=[],this.query=[],this.result=[],this.metadata={},this.scope="",this.mode="",this.name="",this}},{key:"join",value:function(t,e){if(this.isEmpty(t)||!this.isString(t))throw new Error("Name is required and it must be string.");if(!this.isArray(e))throw new Error("Data must be an array object.");return"shallow"===this.mode?this.data2=this.shallowClone(e):this.data2=this.deepClone(e),this.name=t,this.scope="join",this}},{key:"merge",value:function(e,r){if("join"!==this.scope)throw new Error("You should join first before doing merge.");if(this.isEmpty(e)||!this.isString(e))throw new Error("Unique identifier key for table 1 is required.");if(this.isEmpty(r)||!this.isString(r))throw new Error("Unique identifier key for table 2 is required.");var i=this.data2.reduce(function(t,e){return t[e[r]]=e,t},{});return this.scope="",this.data1=this.data1.map(function(t){return Object.assign(t,i[t[e]])}),this}},{key:"on",value:function(s,a,u,h){var f=this;if(u=void 0===u||u,h=void 0===h||h,"join"!==f.scope)throw new Error("You should join first before doing join on.");if(this.isEmpty(s)||!this.isString(s))throw new Error("Unique identifier key for table 1 is required.");if(this.isEmpty(a)||!this.isString(a))throw new Error("Unique identifier key for table 2 is required.");var l=f.data2.reduce(function(t,e){return t[e[a]]=e,t},{}),c=[];return f.data1.map(function(r,t){for(var i={},n=Object.keys(f.data1[t]),e=n.length,o=0;o<e;o++)!function(e){n[e]===s?f.name===n[e]?i[n[e]]=u?l[f.data1[t][n[e]]]:f.data2.filter(function(t){return!h&&f.isString(t[a])&&f.isString(r[n[e]])?t[a].toLowerCase()===r[n[e]].toLowerCase():t[a]===r[n[e]]}):(i[f.name]=u?l[f.data1[t][n[e]]]:f.data2.filter(function(t){return!h&&f.isString(t[a])&&f.isString(r[n[e]])?t[a].toLowerCase()===r[n[e]].toLowerCase():t[a]===r[n[e]]}),i[n[e]]=r[n[e]]):i[n[e]]=r[n[e]]}(o);return c.push(i)}),f.scope="",f.data1=c,this}},{key:"orderBy",value:function(t,e,r){return e=void 0!==e&&e,!this.isEmpty(t)&&this.isString(t)&&this.isBoolean(e)&&this.data1.sort(this._sortBy(t,e,r)),this}},{key:"groupDetail",value:function(i){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(this.isEmpty(i)||!this.isString(i))throw new Error("name is required and must be string.");if(!this.isString(t))throw new Error("group name must be string.");var e=this.data1.reduce(function(t,e){var r=e[i];return t[r]=(t[r]||[]).concat(e),t},{}),r=[];return t?r.push(_defineProperty({},t,e)):r.push(_defineProperty({},i,e)),this.data1=r,this}},{key:"groupBy",value:function(n){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(this.isEmpty(n)||!this.isString(n))throw new Error("name is required and must be string.");if(!this.isArray(o))throw new Error("field name for sum must be array.");var s=o.length,t=this.data1.reduce(function(t,e){if(e.item_count=1,e[n]in t){for(var r=0;r<s;r++)t[e[n]][o[r]]+=e[o[r]];t[e[n]].item_count+=1}else t.__array.push(t[e[n]]=e);for(var i=0;i<s;i++)t[e[n]]["average_"+o[i]]=t[e[n]][o[i]]/t[e[n]].item_count;return t},{__array:[]});return this.data1=t.__array,this}},{key:"skip",value:function(t){return!this.isEmpty(t)&&this.isInteger(t)&&(this.data1=this.data1.slice(t)),this}},{key:"take",value:function(t){return this.isEmpty(t)||(t=parseInt(t),this.isInteger(t)&&this.data1.length>t&&(this.data1.length=t)),this}},{key:"paginate",value:function(t,e){var r;return this.isEmpty(t)||this.isEmpty(e)||(t=parseInt(t),e=parseInt(e),this.isInteger(t)&&this.isInteger(e)&&(r=this.data1.length,--t,this.data1=this.data1.slice(t*e,(t+1)*e),this.metadata={page:t+1,page_size:e,total_page:Math.ceil(r/e),total_records:r})),this}},{key:"promisify",value:function(r){var i=this;return new Promise(function(t,e){try{t(r.call(i,i))}catch(t){e(t)}})}},{key:"exec",value:function(){return this.mode="",this.data1}}]),r}();e.exports=t},{"./helper":2,"./operator":3}],2:[function(require,module,exports){var Helper=function(){function Helper(){_classCallCheck(this,Helper)}return _createClass(Helper,[{key:"isString",value:function(t){return"string"==typeof t||t instanceof String}},{key:"isInteger",value:function(t){return Number.isInteger(t)}},{key:"isBoolean",value:function(t){return"boolean"==typeof t||"object"===_typeof(t)&&null!==t&&"boolean"==typeof t.valueOf()}},{key:"isArray",value:function(t){return void 0!==t&&""!==t&&(t&&""!==t&&"object"===_typeof(t)&&t.constructor===Array)}},{key:"isObject",value:function(t){return void 0!==t&&""!==t&&(t&&"object"===_typeof(t)&&t.constructor===Object)}},{key:"isEmpty",value:function(t){return null==t||""===t}},{key:"isEmptyArray",value:function(t){return null==t||0===t.length}},{key:"isEmptyObject",value:function(t){return null==t||0===Object.keys(t).length&&t.constructor===Object}},{key:"foreach",value:function(e,t){if(this.isObject(e))for(var r=Object.keys(e),i=Object.keys(e).map(function(t){return e[t]}),n=0,o=r.length;n<o;n++)t(i[n],r[n]);else{if(!Array.isArray(e))throw new Error("Failed to iteration. Data is not an array or object.");for(var s=0,a=e.length;s<a;s++)t(e[s],s)}}},{key:"blockingTest",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3,e=Date.now(),r=e+t;Date.now()<r;);return e}},{key:"safeStringify",value:function(t,e){var r=[],e=JSON.stringify(t,function(t,e){if(!(t&&0<t.length)||"$"!==t.charAt(0)&&"_"!==t.charAt(0)){if("object"===_typeof(e)&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}},e),r=null;return e}},{key:"shallowClone",value:function(t){return[].concat(t)}},{key:"deepClone",value:function(t){var e;if("object"!==_typeof(t)||!t)return t;if("[object Array]"===Object.prototype.toString.apply(t)){e=[];for(var r=t.length,i=0;i<r;i++)e[i]=this.deepClone(t[i]);return e}for(i in e={},t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=this.deepClone(t[i]));return e}},{key:"jsonTransform",value:function jsonTransform(data,map){var helper=new Helper;return{defaultOrNull:function(t){return t&&map.defaults?map.defaults[t]:null},getValue:function(t,e,r){if(void 0!==t){if(null==e||""===e)return t;for(var i=t,n=null,o=0,s=(n=e.split(".")).length;o<s;o++){if(!(void 0!==i&&n[o]in i))return this.defaultOrNull(r);i=i[n[o]]}return i}},setValue:function(t,e,r){if(void 0!==t&&""!==e&&void 0!==e&&null!=e)for(var i=e.split("."),n=t,o=0,s=i.length;o<s;o++){if(o===i.length-1)return void(n[i[o]]=r);if(!(i[o]in n))return;n=n[i[o]]}},getList:function(){return this.getValue(data,map.list)},make:function(t){var e=this.getValue(data,map.list),r=[];return helper.isEmptyObject(e)||(e=this.getList(),r=map.item?e.map(this.iterator.bind(this,map.item)):e,r=this.operate.bind(this,r)(t),r=this.each(r,t),r=this.removeAll(r)),r},removeAll:function(t){return Array.isArray(map.remove)&&helper.foreach(t,this.remove),t},remove:function(t){for(var e=0,r=map.remove.length;e<r;e++)delete t[map.remove[e]];return t},operate:function operate(data,context){return map.operate&&helper.foreach(map.operate,function(method){data=data.map(function(item){var fn,fn="string"==typeof method.run?eval(method.run):method.run;return this.setValue(item,method.on,fn(this.getValue(item,method.on),context)),item}.bind(this))}.bind(this)),data},each:function(t,i){return map.each&&t.forEach(function(t,e,r){return map.each(t,e,r,i)}),t},iterator:function(t,i){var n={};return"string"==typeof t?this.getValue(i,t):(helper.foreach(t,function(t,e){var r;"string"==typeof t&&0<t.length?n[e]=this.getValue(i,t,e):Array.isArray(t)?(r=t.map(function(t,e){return this.iterator(e,t)}.bind(this,i)),n[e]=r):"object"===_typeof(t)?(t=this.iterator.bind(this,t,i),n[e]=t()):n[e]=""}.bind(this)),n)}}}}]),Helper}();module.exports=Helper},{}],3:[function(t,e,r){e.exports={unstrict:function(t,e,r){switch(t){case"=":case"==":return e==r;case"!=":return e!=r;default:throw new Error("Comparisons operator is not available!")}}}},{}]},{},[1])(1)});